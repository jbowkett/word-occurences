package info.bowkett.wordoccurences;

import org.junit.Test;

import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;
import java.io.File;

import static org.junit.Assert.assertEquals;

/**
 * FeedHandler Tester.
 *
 * @author <Authors name>
 * @version 1.0
 * @since <pre>Oct 14, 2014</pre>
 */
public class FeedHandlerTest {

  @Test
  public void test() throws Exception {
    final File feedFile = new File("src/test/resources/one-post.rss");
    final SAXParserFactory fact = SAXParserFactory.newInstance();
    final SAXParser saxParser = fact.newSAXParser();
    final FeedHandler feedHandler = new FeedHandler(new PostBuilder());
    saxParser.parse(feedFile, feedHandler);
    assertEquals(1, feedHandler.getPosts().size());



    final String expected =
        "<p>By <a href=\"http://investing.covestor.com/author/a2m-capital\" title=\"A2M Capital LLC\">A2M Capital LLC</a></p> <p>U.S. stock prices have displayed a distinct trading pattern in the last two years. Since the beginning of 2013, the S&amp;P 500 Index has found support after low-volatility sell-offs" +
        "at its 100-day moving average (100 DMA).</p> <p>This line of support has been acting as a springboard for sharp moves higher as a result of short covering by various market participants, who were expecting a deeper correction.</p> <p><img class=\"aligncenter wp-image-40923\" src=\"http://investing.cove" +
        "stor.com/content/2014/10/bull-market-losing-steam-in-october.png\" alt=\"bull-market-losing-steam-in-october\" width=\"450\" height=\"326\" /></p> <p>&nbsp;</p> <p>This pattern has occurred seven times during this recent low volatility period. Now, the stock market rally is looking a little parched.</p> <p>&nbsp;</p> <h3>Changing winds</h3> <p>To be honest, we found ourselves on the short side as well in some of these situations, which is one of the reasons why the <a href=\"http://covestor.com/a2m-capital/technical-swing\">Technical Swing portfolio</a> underperformed during the last year.</p> <p>The question is how long will the 100 DMA pattern keep on working. There are reasons to believe that the environment has changed and the support line could fail.</p> <p>One reason to be cautious is the fact that the pattern has become too obvious for everybody. <strong>Markets have a tendency to surprise the maximum number of people.</strong></p> <p>It is a law of market efficiency that obvious patterns have to defeat themselves once everybody tries to trade them.</p> <p>It is impossible to predict when patterns stop to work. However, markets are probabilistic, so t<strong>he chance that the S&amp;P 500 will not find support at the 100 DMA is decreasing over time.</strong></p> <p>Another way to evaluate patterns is to simply try to find out if the market environment has changed by analyzing intermarket relationships.</p> <p>&nbsp;</p> <h3>Throttle back</h3> <p>If the environment changes, it might make sense to be less aggressive. Chart 1 shows the S&amp;P 500, the US Dollar Index ETF<a href=\"http://stocks.covestor.com/uup\"> (UUP)</a> and <a href=\"http://stocks.covestor.com/ezu\">(EZU)</a>, a European stocks ETF for the last two years.</p> <div id=\"attachment_40918\" style=\"width: 374px\" class=\"wp-caption aligncenter\"><img class=\"size-full wp-image-40918\" src=\"http://investing.covestor.com/content/2014/10/AROLD-Chart-1.png\" alt=\"100 DMA\" width=\"364\" height=\"582\" /><p class=\"wp-caption-text\">Click to Enlarge</p></div> <p>&nbsp;</p> <p>Almost the entire period can be characterized by an environment, where the U.S. dollar was declining and European stocks moved in sync with US equity markets.</p> <p>But something changed in the last months:<strong> in July, the Greenback started to rise shapely and Europe went into a deeper correction, thus decoupling from American stocks.</strong></p> <p>We don&#8217;t care, why the environment is different. The fact that it has changed tells us to be careful  with patterns that worked in the past.</p> <p>In addition, US stocks have been flashing a big warning sign for over a year: fewer and fewer stocks have been participating in the rally.</p> <p>Chart 2 shows the number of S&amp;P 500 stocks at new 52 week highs. <strong>As one can see, the rally was a healthy one until the mid of 2013.</strong></p> <p>&nbsp;</p> <div id=\"attachment_40919\" style=\"width: 366px\" class=\"wp-caption aligncenter\"><img class=\"size-full wp-image-40919\" src=\"http://investing.covestor.com/content/2014/10/AROLD-Chart-2.png\" alt=\"technical-stock-chart\" width=\"356\" height=\"520\" /><p class=\"wp-caption-text\">Click to Enlarge</p></div> <p>&nbsp;</p> <p>But since then, the number of participating stocks has been declining. We wrote about this phenomenon in earlier reports. It is impossible to exactly time the market using this indicator.</p> <p><strong>Yet, historically, major market tops have been preceded by fewer participating stocks.</strong></p> <p>So what does this all mean? Unless new bullish signs emerge, this is not the time to load up on equities. Markets are currently oversold, so sharp rallies could happen any days.</p> <p><strong>Chances are they will be short-lived in my opinion.</strong></p> <p>&nbsp;</p> <p>&#8212;</p> <p>&nbsp;</p> <p><!--HubSpot Call-to-Action Code --><br /> <span id=\"hs-cta-wrapper-d35c314d-234a-4afd-8b0d-7fc75bf8873c\" class=\"hs-cta-wrapper\"><br /> <span id=\"hs-cta-d35c314d-234a-4afd-8b0d-7fc75bf8873c\" class=\"hs-cta-node hs-cta-d35c314d-234a-4afd-8b0d-7fc75bf8873c\"><br /> <!-- [if lte IE 8]></p> <div id=\"hs-cta-ie-element\"></div> <p><![endif]--><br /> <a href=\"http://cta-redirect.hubspot.com/cta/redirect/304233/d35c314d-234a-4afd-8b0d-7fc75bf8873c\"><img id=\"hs-cta-img-d35c314d-234a-4afd-8b0d-7fc75bf8873c\" class=\"hs-cta-img\" style=\"border-width: 0px;\" src=\"https://no-cache.hubspot.com/cta/default/304233/d35c314d-234a-4afd-8b0d-7fc75bf8873c.png\" alt=\"\" /></a><br /> </span><br /> <script src=\"https://js.hscta.net/cta/current.js\" charset=\"utf-8\"></script><script>// <![CDATA[ hbspt.cta.load(304233, 'd35c314d-234a-4afd-8b0d-7fc75bf8873c');</p> <p>// ]]&gt;</script><br /> </span><br /> <!-- end HubSpot Call-to-Action Code --></p> <p>&nbsp;</p> <p><i>DISCLAIMER: </i><i>The reader should not assume that any investments identified were or will be profitable or that any investment recommendations or investment decisions we make in the future will be profitable. </i><b><i>Past performance is no guarantee of future results.</i></b></p> <p class=\"legal\">The post <a href=\"http://investing.covestor.com/2014/10/technical-swing-stock-market-springboard-broken\">Is this bull market running out of oomph?</a> appeared first on <a href=\"http://investing.covestor.com\">Smarter Investing</a>\n" +
        "\n" +
        " <em>Covestor Ltd. is a registered investment advisor. Covestor licenses investment strategies from its Model Managers to establish investment models. The commentary here is provided as general and impersonal information and should not be construed as recommendations or advice. Information from Model Managers and third-party sources deemed to be reliable but not guaranteed. Past performance is no guarantee of future results. Transaction histories for Covestor models available upon request. Additional important disclosures available at http://site.covestor.com/help/disclosures. For information about Covestor and its services, go to http://covestor.com or contact Covestor Client Services at (866) 825-3005, x703.</em></p> <div class=\"manager-content\"><div class=\"manager-profile\"><a href=\"http://investing.covestor.com/author/a2m-capital\" title=\"A2M Capital LLC\"><img src=\"http://cdn03.content.covestor.com/content/a2m-capital/_profile-154x154.jpg\" alt=\"A2M Capital LLC\" width=\"70\" height=\"70\" class=\"profile-image\" /></a><div class=\"author-info\"><h4>A2M Capital LLC</h4><p>A2M Capital, LLC is a registered investment advisor, based in Germany. We apply active investment strategies based on quantitative and<a href=\"http://investing.covestor.com/author/a2m-capital\" title=\"A2M Capital LLC\">&hellip;</a></p></div><div class=\"model-chart\"><iframe id=\"covestor-widget-technical-swing\" width=\"202\" height=\"412\" style=\"border:none;\" src=\"http://widgets.covestor.com//manager-widget-service?widget=chart&amp;manager=a2m-capital&amp;model=technical-swing&amp;version=0\" name=\"CovWidgetFrame\"></iframe></div></div></div><img src=\"http://track.hubspot.com/__ptq.gif?a=304233&k=14&bu=http%3A%2F%2Finvesting.covestor.com%2Fnews&r=http%3A%2F%2Finvesting.covestor.com%2F2014%2F10%2Ftechnical-swing-stock-market-springboard-broken&bvt=rss&p=wordpress\" style=\"float:left;\" xml:base=\"http://investing.covestor.com/feed\" width=\"1\" height=\"1\" border=\"0\" align=\"right\"/>";
    assertEquals(expected, feedHandler.getPosts().get(0).getContent());
  }

} 
